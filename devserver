#!/usr/bin/env bash

set -e

cleanup() {
    echo "Stopping dev server..."
    kill "$SERVER_PID" 2>/dev/null || true
    exit
}

trap cleanup INT TERM

echo "Starting Spring Boot dev server..."
mvn spring-boot:run &
SERVER_PID=$!

echo "Dev server PID: $SERVER_PID"
echo "Watching for file changes..."

while kill -0 "$SERVER_PID" 2>/dev/null; do
    find src/main/java -name "*.java" |
        entr -d mvn -q compile
done

echo "Dev server exited."
exit 0
